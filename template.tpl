___INFO___

{
  "displayName": "AdRoll Group Pixel",
  "description": "An AdRoll Group Pixel tag helps advertisers to use their site data in conjunction with the AdRoll and RollWorks platforms. Visit adrollgroup.com to learn more.",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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",
    "displayName": "",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "displayName": "Advertisable EID",
    "simpleValueType": true,
    "name": "customerId",
    "type": "TEXT"
  },
  {
    "displayName": "Pixel EID",
    "simpleValueType": true,
    "name": "pixelId",
    "type": "TEXT"
  },
  {
    "displayName": "Conversion Value",
    "simpleValueType": true,
    "name": "conversionValueInDollars",
    "type": "TEXT"
  },
  {
    "displayName": "Conversion Value Currency",
    "defaultValue": "USD",
    "simpleValueType": true,
    "name": "conversionValueCurrency",
    "type": "TEXT"
  },
  {
    "displayName": "Order ID",
    "simpleValueType": true,
    "name": "orderId",
    "type": "TEXT"
  },
  {
    "displayName": "Product ID",
    "simpleValueType": true,
    "name": "productId",
    "type": "TEXT"
  },
  {
    "displayName": "Product Group",
    "simpleValueType": true,
    "name": "productGroup",
    "type": "TEXT"
  },
  {
    "displayName": "Custom Data",
    "name": "customData",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Key",
        "name": "cdKey",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "cdValue",
        "type": "TEXT"
      }
    ],
    "type": "SIMPLE_TABLE",
    "newRowButtonText": "+ Add Custom Data"
  },
  {
    "displayName": "Segment Name",
    "simpleValueType": true,
    "name": "segmentName",
    "type": "TEXT"
  }
]


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://s.adroll.com/j/roundtrip.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adroll_adv_id"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adroll_pix_id"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__adroll_loaded"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adroll_conversion_value"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adroll_currency"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adroll_segments"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "adroll_custom_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const copyFromWindow = require('copyFromWindow');
const injectScript = require('injectScript');
const log = require('logToConsole');
const makeTableMap = require('makeTableMap');
const setInWindow = require('setInWindow');

setInWindow('adroll_adv_id', data.customerId, true);
setInWindow('adroll_pix_id', data.pixelId, true);
setInWindow('adroll_conversion_value', data.conversionValueInDollars, true);
setInWindow('adroll_currency', data.conversionValueCurrency || "USD", true);
setInWindow('adroll_segments', data.segmentName, true);

let adroll_custom_data = copyFromWindow('adroll_custom_data');
if (typeof adroll_custom_data !== 'object') {
  adroll_custom_data = {};
}

const customDataMap = makeTableMap(data.customData || [], 'cdKey', 'cdValue');
for (let key in customDataMap) {
  adroll_custom_data[key] = customDataMap[key];
}

adroll_custom_data.order_id = data.orderId;
adroll_custom_data.product_id = data.productId;
adroll_custom_data.product_group = data.productGroup;
setInWindow('adroll_custom_data', adroll_custom_data, true);

setInWindow('__adroll_loaded', true, true);

injectScript(
    'https://s.adroll.com/j/roundtrip.js',
    data.gtmOnSuccess, data.gtmOnFailure);


___NOTES___

Created on 8/29/2019, 2:53:13 PM
